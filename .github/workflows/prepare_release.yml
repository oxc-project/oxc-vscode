name: Prepare Release

permissions: {}

on:
  workflow_dispatch:
    inputs:
      version:
        type: string
        required: true
        description: Version to release (e.g., 1.44.0)
      pre-release:
        type: boolean
        required: false
        default: false
        description: Publish as pre-release (not tagged as latest)

jobs:
  prepare:
    name: Prepare Release
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
        with:
          persist-credentials: false

      - name: Update version in package.json
        run: |
          npm pkg set version="${{ inputs.version }}"

      - uses: peter-evans/create-pull-request@c0f553fe549906ede9cf27b5156039d195d2ece0 # v8.1.0
        with:
          token: ${{ secrets.OXC_BOT_PAT }}
          commit-message: "release: v${{ inputs.version }}${{ inputs.pre-release && ' [pre-release]' || '' }}"
          title: "release: v${{ inputs.version }}${{ inputs.pre-release && ' (pre-release)' || '' }}"
          branch: release/v${{ inputs.version }}
          base: main
          body: |
            ## Release v${{ inputs.version }}

            ${{ inputs.pre-release && '⚠️ This is a **pre-release** version.' || '' }}

            Merging this PR will trigger the release workflow.
          assignees: Boshen
